{% extends "base.html" %}
{% block content %}
<div>
    {% if telegram_not_authorized %}
        <h2>Вы не авторизованы</h2>
        <!-- Telegram Login Widget -->
        <script async src="https://telegram.org/js/telegram-widget.js?19"
                data-telegram-login="ВАШ_BOT_USERNAME"
                data-size="medium"
                data-userpic="false"
                data-request-access="write"
                data-auth-url=""
                data-on-auth="onTelegramAuth">
        </script>

        <script>
            // При авторизации вызывается эта функция:
            function onTelegramAuth(user) {
                console.log("Telegram user data:", user);
                // Шлём POST-запрос на /login/telegram
                fetch("/login/telegram", {
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify(user)
                })
                .then(res => res.json())
                .then(data => {
                    if(data.ok){
                        // Релоад или редирект:
                        window.location.reload();
                    } else {
                        alert("Ошибка авторизации: " + data.error);
                    }
                })
            }
        </script>
    {% elif role == "waiter" %}
        <h2>Здравствуйте, официант!</h2>
        <div id="calendar"></div>
        <!-- Календарь и кнопки для добавления/изменения "approximate" событий -->
        <!-- Логика отображения в calendar.js -->
    {% else %}
        <h2>Неизвестная роль или не авторизованы</h2>
    {% endif %}
</div>
{% endblock %}
